<div class="data-table-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="loading-spinner"></div>
    <p>Chargement des données...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && data.length === 0" class="empty-state">
    <i class="ri-inbox-line empty-icon"></i>
    <p>{{ emptyMessage }}</p>
  </div>

  <!-- Table -->
  <div *ngIf="!loading && data.length > 0" class="table-wrapper">
    <table class="data-table">
      <thead>
        <tr>
          <th
            *ngFor="let column of columns"
            [style.width]="column.width"
            [class.sortable]="column.sortable">
            {{ column.label }}
            <i *ngIf="column.sortable" class="ri-arrow-up-down-line sort-icon"></i>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let item of pagedData"
          class="data-row"
          (click)="rowClickable && onRowClick(item)">
          <td *ngFor="let column of columns" [attr.data-label]="column.label" [attr.data-type]="column.type">
            <!-- Actions Column -->
            <div *ngIf="column.type === 'actions'" class="actions-cell">
              <button
                *ngFor="let action of actions"
                [class]="'btn-action ' + (action.class || 'btn-default')"
                [class.visible]="isActionVisible(action, item)"
                (click)="onActionClick(action.action, item, $event)"
                [title]="action.label">
                <i *ngIf="action.icon" [class]="action.icon"></i>
                <span>{{ action.label }}</span>
              </button>
            </div>

            <!-- Regular Data -->
            <span *ngIf="column.type !== 'actions' && column.type !== 'image'"
              [class]="'cell-content ' + (column.type === 'status' && getCellValue(item, column) !== '-' ? 'status-' + getCellValue(item, column) : '')">
              {{ column.formatter ? column.formatter(getCellValue(item, column)) : getCellValue(item, column) }}
            </span>

            <!-- Image Column -->
            <div *ngIf="column.type === 'image'" class="image-cell">
              <img
                *ngIf="getCellValue(item, column)"
                [src]="getImageSrc(getCellValue(item, column))"
                [alt]="column.label"
                class="table-image"
                (click)="onImageClick($event, getImageSrc(getCellValue(item, column)))"
                role="button"
                title="Cliquer pour agrandir"
                (error)="onImageError($event)">
              <div *ngIf="!getCellValue(item, column)" class="no-image">
                <i class="ri-image-line"></i>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <!-- Pagination controls (client-side) -->
    <div *ngIf="pageable && totalPages > 1" class="table-pagination">
      <div class="pagination-info">Affichage {{ ((currentPage-1)*pageSize)+1 }} - {{ Math.min(currentPage*pageSize, data.length) }} sur {{ data.length }}</div>
      <div class="pagination-controls">
        <button class="page-btn" [disabled]="currentPage===1" (click)="prevPage()">Préc</button>
        <button *ngFor="let p of [].constructor(totalPages); let i = index" class="page-number" [class.active]="currentPage===i+1" (click)="changePage(i+1)">{{ i+1 }}</button>
        <button class="page-btn" [disabled]="currentPage===totalPages" (click)="nextPage()">Suiv</button>
      </div>
    </div>
  </div>
  
  <!-- Image preview modal -->
  <app-modal [open]="imageModalOpen" [size]="'large'" [showFooter]="false" (close)="closeImage()">
    <div class="image-preview" *ngIf="imageModalUrl">
      <img [src]="imageModalUrl" alt="Aperçu image" />
    </div>
  </app-modal>
</div>
