<app-header mode="compact"></app-header>

<div class="circuit-detail-container">
  <div class="detail-card" *ngIf="demande; else loading">
    <div class="detail-header">
      <button class="btn-back" (click)="goBack()">← Retour à la liste</button>
      <h1>Demande de circuit personnalisé #{{ demande.id }}</h1>
      <div class="status-badge" [ngClass]="getStatusBadgeClass(demande.statut || 'EN_ATTENTE')">
        {{ demande.statut || 'EN_ATTENTE' }}
      </div>
    </div>

    <div class="detail-content">
      <!-- Informations client -->
      <div class="info-section">
        <h2>Informations client</h2>
        <div class="info-grid">
          <div class="info-item">
            <label>Nom :</label>
            <span>{{ demande.prenomClient }} {{ demande.nomClient }}</span>
          </div>
          <div class="info-item">
            <label>Email :</label>
            <span>{{ demande.emailClient }}</span>
          </div>
          <div class="info-item">
            <label>Téléphone :</label>
            <span>{{ demande.telephoneClient }}</span>
          </div>
          <div class="info-item">
            <label>Date de soumission :</label>
            <span>{{ demande.dateCreation ? formatDate(demande.dateCreation) : 'N/A' }}</span>
          </div>
        </div>
      </div>

      <!-- Détails du circuit -->
      <div class="info-section">
        <h2>Détails du circuit demandé</h2>
        <div class="info-grid">
          <div class="info-item">
            <label>Nombre de personnes :</label>
            <span>{{ demande.nombrePersonnes }}</span>
          </div>
          <div class="info-item">
            <label>Nombre de jours :</label>
            <span>{{ demande.nombreJours }}</span>
          </div>
          <div class="info-item">
            <label>Hébergement inclus :</label>
            <span>{{ demande.avecHebergement ? 'Oui' : 'Non' }}</span>
          </div>
          <div class="info-item">
            <label>Transport inclus :</label>
            <span>{{ demande.avecTransport ? 'Oui' : 'Non' }}</span>
          </div>
          <div class="info-item" *ngIf="demande.prixEstime">
            <label>Prix estimé :</label>
            <span class="prix">{{ formatPrix(demande.prixEstime) }}</span>
          </div>
        </div>
      </div>

      <!-- Zones et activités -->
      <div class="info-section">
        <h2>Jours du circuit</h2>
        <div class="zones-activites">
          <div *ngFor="let jour of demande.jours" class="jour-section">
            <h3>Jour {{ jour.numeroJour }}</h3>
            <div *ngIf="jour.zoneNom"><strong>Zone :</strong> {{ jour.zoneNom }}</div>
            <div *ngIf="jour.villeNom"><strong>Ville :</strong> {{ jour.villeNom }}</div>
            <div *ngIf="jour.activiteNoms && jour.activiteNoms.length > 0">
              <strong>Activités :</strong> 
              <span class="tag" *ngFor="let activite of jour.activiteNoms">{{ activite }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions-section" *ngIf="demande.statut === 'EN_ATTENTE'">
        <h2>Actions</h2>
        <div class="action-buttons">
          <button class="btn-approve" (click)="approveDemande()">
            ✅ Approuver la demande
          </button>
          <button class="btn-reject" (click)="rejectDemande()">
            ❌ Refuser la demande
          </button>
        </div>
      </div>

      <div class="actions-section" *ngIf="demande.statut === 'Validé'">
        <h2>Actions supplémentaires</h2>
        <div class="action-buttons">
          <!-- TODO: Implémenter la conversion en circuit catalogue -->
        </div>
      </div>
    </div>
  </div>

  <ng-template #loading>
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Chargement des détails de la demande...</p>
    </div>
  </ng-template>
</div>